=====================
   pvoks component
=====================

admin menü
==========
config
kategóriák
members
szavazások
alternativák
szavazók
támogatások

front-end menü
==============
kategória lista (parent_id)
szavazás lista (category_id)
szavazás adatlap (question_id)
szavazás ürlap (question_id)
eredmény (question_id, group=0)
statisztika (category_id)


======================
    pvoks modul
======================
Az aktuális (session és input) pvoks status és az aktuálus user alapján
akciógombokat és statisztikát tud megjeleniteni
opciok
buttons:
- add-category
- edit-category
- del-category
- support-category
- get-questions-list
- get-members-list
- add-question
- edit-question
- del-question
- support-question
- get-options-list
- add-option
- edit-option
- del-option
- support-option
- add-member
- edit-member
- del-member
- support-member
- add-voks
- del-voks
- get-result
- get-votes
- get-statistic
- add-comment
- view-comment
- merge-questions
- merge-options
- send-email
display
-comment-form
-comment-list
-statistic

	


pvoksHelperScripts
==================

getList -> lista html options formában
run($script_id)



Táblák
======
#__pvoks_config
   id,config_type,title, json, created, cretaed_by, modified, modified_by, order, state

	json global és "category" esetén
	--------------------------------
	{"defCategorySuggestiion":Y/N,
	 "defQuestionSuggestion":Y/N,
	 "defOptionSuggestion":Y/N,
	 "defMemberSuggestion":Y/N,
	 "defQuestionType":szám,
	 "acrediteEnabled": Y/N,
	 "groupactions":["group" => ["xxxx","xxxx",......]
	 "scripts":["event" => "script_id",...],
	 "lngStrings":["token" => "xxxxxx",....]
	}


	json a question_type esetén:
	----------------------------
	{"steps":{"title":"xxxxxx", "groupactions":["group" => ["xxxx","xxxx",......],"termin":"szám vagy képlet"]},
	 "scripts":["event" => "script_id",...],
	 "lngStrings":["token" => "xxxxxx",....]
	}
	state: published|unpublished
	config_type: global | category | question
	
#__pvoks_categories
	id, parent_id, category_type, title, alias, introtext, fulltext, created, cretaed_by, modified, modified_by, order, state
	state: unpublished|suggestion|opened|closed
#__pvoks_questions
	id, category_id, question_type, title, alias, introtext, fulltext, 
	created, cretaed_by, modified, modified_by, order, state, publicVote,
	state: unpublished|suggestion|stepNo	
	termins:["stepNo"=>enddate]
#__pvoks_options
	id, question_id, title, alias, introtext, fulltext, created, cretaed_by, modified, modified_by, state
	state: suggestion|published|unpublished
#__pvoks_members   (id. category_id, user_id, state, admin
	id, category_id, user_id, remark, created, cretaed_by, modified, modified_by, state
	state: unpublished|suggestion|member|acredited
#__pvoks_acrediteds
	id, category_id, user_id, acredited_id, created, modified
#__pvoks_votes
	id, question_id, option_id, position, anonym_voter, voter_id, created 
#__pvoks_voters
	id, question_id, voter_id, created 
	
#__pvoks_supports  (id, objtype, object_id, user_id)
	id, object_type, object_id, user_id, created
	object_type = category|question|option|member
#__pvoks_logs
    id, time, object_type, object_id, user_id, action, description	


usergroups
==========
registered
  ada-xxxx   ada assurance kod
  ada-xxxx



"group" felhasználói csoportok
------------------------------
guest  látogató, nincs bejelentkezve
registered  ADA -val be van jelentkezve, de semmilyen tanúsítványa nincs,
ada-email email ellenõrzött ADA bejelentkezés. 
ada-magyar Magyar tanusítvánnyal rendelkezõ ADA bejelntkezés. 
ada-oevk Magyar tanusítvánnyal és egy oevk tanusítvánnyal rendelkezõ ADA bejelentkezés 
ada-vm  Magyar, oevk és választói mozgalom tanusítvánnyal rendelkezõ ADA bejelentkezés. 
category-creator  az aktuális category létrehozója
question-creator  az aktuális szavazás létrehozója
option-creator  az aktuális opció létrehozója
category-candidates  tagságra jelentkezett
category-member  az aktuális kategória tagja
category-admin  az aktuális kategória adminisztrátora
category-acredited képviselõ
admin adminisztrátor. 

"action" kodok tranzakciók 
--------------------------
view-categories
view-members
view-sugestion Ötletek listájának és bõvebb leírásának megtekintése
view-alternative  Alternatívák listájának és bõvebb leírásának a megtekintése
view-creator-nick 	Az ötlet beküldõ nick nevének megjelenítése
view-creator-name  	Az ötlet beküldõ valódi nevének megjelenítése
view-comment  A szavazáshoz tartozó kommentek megjelenítése. Ez egy “gyári” joomla extension,  a “nick” nevet jeleniti meg a kommenteknél.
view-vokscount  A leadott szavazatok számának kijelzése
view-result  A szavazás eredményének vagy pillanatnyi részeredményének megjelenitése (alternativák condorcet sorrendben).

category-add   Új kategória (javaslat) beküldése
question-add  Új szavazási ötlet beküldése.
option-add    Új megoldási ötlet beküldése.
member-add    Új témakör tagság

category-suggestion-edit  Ötlet modosítása (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet módosíthatnak)
category-suggestion-delete  Ötlet törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
category-suggestion-merge  Ötletek összevonása
category-suggestion-support  Ötlet “szavazásra, vitára javaslom” bejelölése, illetve ennek visszavonása
category-edit  Alternatíva módosítása (ha ez a lehetõség adott akkor adminok minden alternativát, mások csak a saját maguk által feltöltöttet módosíthatnak)
category-delete  Alternatíva törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
category-merge  Két alternatíva összevonása

question-suggestion-edit  Ötlet modosítása (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet módosíthatnak)
question-suggestion-delete  Ötlet törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
question-suggestion-merge  Ötletek összevonása
question-suggestion-support  Ötlet “szavazásra, vitára javaslom” bejelölése, illetve ennek visszavonása
question-edit  Alternatíva módosítása (ha ez a lehetõség adott akkor adminok minden alternativát, mások csak a saját maguk által feltöltöttet módosíthatnak)
question-delete  Alternatíva törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
question-merge  Két alternatíva összevonása

option-suggestion-edit  Ötlet modosítása (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet módosíthatnak)
option-suggestion-delete  Ötlet törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
option-suggestion-merge  Ötletek összevonása
option-suggestion-support  Ötlet “szavazásra, vitára javaslom” bejelölése, illetve ennek visszavonása
option-edit  Alternatíva módosítása (ha ez a lehetõség adott akkor adminok minden alternativát, mások csak a saját maguk által feltöltöttet módosíthatnak)
option-delete  Alternatíva törlése (ha ez a lehetõség adott akkor adminok minden suggestiont, mások csak a saját maguk által feltöltöttet törölhetnek)
option-merge  Két alternatíva összevonása

member-suggestion-edit
member-suggestion-delete
member-edit
member-delete
member-suggestion-support

comment-add  Komment beküldése (a “gyári” extension adminok számára mindig megengedi a moderálást)
voks-add  szavazás (alternativás szimpátia sorrendbe rendezése)
voks-delete  Saját leadott szavazatom törlése
set-step  	Szavazás állapotának modosítása

"event" esemény kodok (ezek a pvoksHelperScripts -ben lévõ funkciokat fogják aktivizálni)
----------------------
afterCategorySupport
afterQuestionSupport
afterOptionSupport
afterMemberSupport
afterVoksAdd
afterVoksDelete
getRequestCategorySupport  
getRequestedQuestionSupport         
getRequestedOptionSupport            
getRequestedMemberSupport           
getTermin(stepNo)
getValidLimit      
getValid           
oncron



pvoksHelperCategory objektum funkció (lehet, hogy a model funkciói)
------------------------------------
__constructor($category)
access(user,action)
getQuestionCount
getRequestSupport  -> szám
getSupporters      -> lista a támogatásra jogosultakról jelölve aki támogatja
supportExists      -> Y/N a bejelentkezett user támogatta már?  
runTrigger(event)        
getErrorMsg
getTxt(token)


pvokHelperQuestion objektum funcioi az is lehet, hogy a model funkciói ezek....
-----------------------------------

__constructor($question)
access(user,action)
getStepTitle  -> string 
getOptionCount
getSuggestionCount
getVoksCount
getVoterCount
getRequestSupport  -> szám
getRequestVoks     -> szám
getSupporters      -> lista a támogatásra jogosultakról jelölve aki támogatja
getVoks            -> tételes szavazat lista (anonim vagy nevesitett) 
getVoters          -> lista a szavazásra jogosultakról, jelölve szavazott-e vagy nem
voksExists         -> Y/N a bejelentkezett user szavazott már? 
supportExists      -> Y/N a bejelentkezett user támogatta már?  
nextStep 
runTrigger(event)        
getErrorMsg
getTxt(token)
getTermin(stepNo)  -> date

// elõtte (ha szükséges) a $user->groups -ot bõviteni kell a "xxxx-creator", category_xxxxx jellemzõkkel
function access($user, $action) {
  $result = true;
  if ($akction == 'voks-add') {
     if ($this->voksExists($user)) {
	   $result = false;
	   $this->errormsg = 'COM_PVOKS_ALREDY_VOKS';
	 }  
  } 
  if ($aktion == 'voks-delete') {
     if ($this->voksExists($user) == false) {
	   $result = false;
	   $this->errormsg = 'COM_PVOKS_ALREDY_NOT_VOKS';
	 }  
  }
  if ($aktion == 'suggestion-support') {
     if ($this->suggestion == false) {
	   $result = false;
	   $this->errormsg = 'COM_PVOKS_THIS_ISNOT_SUGGESTION';
	 }  
  }
  if ($result) {
    $result = false;
    foreach ($user->groups as $group) {
	  if (in_array($action, $this->steps[$this->step]->groupActions[$group])) $result = true;
	}   
  }
  return $result;
}

function getTxt($token) {
  if (isset($this->config->lnsStrings[$token]))
    $result = $this->config->lnsStrings[$token];
  else
    $result = JText::_($token);
  return $result;	
}

function getVoterCount() {
   $groups = array();
   foreach ($this->steps as $step) {
     foreach ($step->groupActions as $group => actions) {
	   if (in_array('voks-add', $actions) $groups[] = $group;
	 }
   }
   // sql keresés a #__users táblában a in inplode(',',$groups)
   
}

A scriptek is hivhatják a fenti funkciókat

pvoksHelperOption objektum funkciói
-----------------------------------
__constructor($option)
access(user,action)
getRequestSupport
getSupportCount
getSupporters  -> lista a támogatásra jogosultakról jelölve aki támogatja
supportExists  -> Y/N a bejelentkezett user támogatta már?  
setOption   - suggestion -ból optionsba állít
runTrigger(event)
getErrorMsg




